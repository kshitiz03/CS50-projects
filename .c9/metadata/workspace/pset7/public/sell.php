{"filter":false,"title":"sell.php","tooltip":"/pset7/public/sell.php","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":50,"column":2},"action":"insert","lines":["<?php","    // configuration","    require(\"../includes/config.php\");","    // if the form was submitted","    ","    if ($_SERVER[\"REQUEST_METHOD\"] == \"POST\")","    {","           ","            $transaction = \"SELL\";","            ","            $stock1 = lookup($_POST[\"symbol\"]);","            ","            $stock2 = CS50::query(\"SELECT * from portfolios WHERE id=? AND symbol=?\",$_SESSION[\"id\"],$_POST[\"symbol\"]);","            ","            $current_price = $stock1[\"price\"] * $stock2[0][\"shares\"]; // Total Current Price of share","            ","            // adding the value of share to cash","            ","            CS50::query(\"UPDATE users SET cash = cash + ? WHERE id = ?\", $current_price, $_SESSION[\"id\"]);","            ","            // deleting stock from portifolios table","            ","            CS50::query(\"DELETE FROM portfolios WHERE id = ? AND symbol = ?\", $_SESSION[\"id\"], $_POST[\"symbol\"]);","            ","            // Updating the history","            CS50::query(\"INSERT INTO history (id, transaction, symbol, shares, price) VALUES (?, ?, ?, ?, ?)\", $_SESSION[\"id\"], $transaction, $_POST[\"symbol\"], $stock2[0][\"shares\"], $stock1[\"price\"]);","            ","            // coming back to portifolio page","             redirect(\"./\");","        ","    }","    ","    else","    {","        // query user's portfolio","        $rows =\tCS50::query(\"SELECT * FROM portfolios WHERE id = ?\", $_SESSION[\"id\"]);\t","        // create new array to store stock symbols","        $stocks = [];","        // for each of user's stocks","        foreach ($rows as $row)\t","        {   ","            // save stock symbol","            $stock = $row[\"symbol\"];","            ","            // add stock symbol to the new array","            $stocks[] = $stock;       ","        }    ","        // render sell form","        render(\"sell_form.php\", [\"title\" => \"Sell Form\", \"stocks\" => $stocks]);","    }","?>"],"id":1}]]},"ace":{"folds":[],"scrolltop":221,"scrollleft":0,"selection":{"start":{"row":50,"column":2},"end":{"row":50,"column":2},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1467955734229,"hash":"5b8e139f6c06173845d61f56f9b6178c48e6d6f7"}